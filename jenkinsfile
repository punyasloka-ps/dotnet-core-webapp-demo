pipeline {
    agent any 
    stages {
        stage('Restore packages') { 
            steps {
                sh "dotnet restore dotnet-core-webapp-demo.csproj"
            }
        }
        stage('Clean Packages') { 
            steps {
                sh "dotnet clean dotnet-core-webapp-demo.csproj"
            }
        }
        stage('Build') { 
            steps {
                sh "dotnet build dotnet-core-webapp-demo.csproj --configuration Release"
            }
        }
        stage('Publish') { 
            steps {
                sh "dotnet publish dotnet-core-webapp-demo.csproj"
            }
        }
        stage('Deploy') {
            steps {
                azureWebAppPublish appName: env.azure-app-name,azureCredentialsId: env.azure-sp-id,resourceGroup: env.azure-app-resourcegroup,sourceDirectory: "src/dotnet-core-webapp-demo/bin/Release/netcoreapp3.1/publish/"
            }
        }
    }
}